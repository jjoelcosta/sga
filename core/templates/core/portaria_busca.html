{% extends "base.html" %}
{% block title %}Consulta de Portaria{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">Consulta de Acesso - Portaria</h2>

  <form method="get" action="{% url 'portaria_busca' %}" class="d-flex justify-content-center mb-4">
    <input type="text" name="q" class="form-control w-50" placeholder="Digite CPF, nome ou placa" value="{{ termo }}">
    <button type="submit" class="btn btn-primary ms-2">Buscar</button>
    <a href="{% url 'portaria_busca' %}" class="btn btn-secondary ms-2">Limpar</a>
  </form>

  {% if resultados %}
    <table class="table table-striped table-bordered text-center">
      <thead class="table-dark">
        <tr>
          <th>Status</th>
          <th>Nome</th>
          <th>Empresa</th>
          <th>Função</th>
          <th>Placa</th>
          <th>Local</th>
          <th>Início</th>
          <th>Fim</th>
        </tr>
      </thead>
      <tbody>
        {% for r in resultados %}
        <tr class="{% if r.status_final == 'LIBERADO' %}table-success{% elif r.status_final == 'BLOQUEADO' %}table-danger{% else %}table-warning{% endif %}">
          <td>{{ r.status_final }}</td>
          <td>{{ r.nome }}</td>
          <td>{{ r.empresa }}</td>
          <td>{{ r.funcao }}</td>
          <td>{{ r.placa }}</td>
          <td>{{ r.local }}</td>
          <td>{{ r.data_inicio|date:"d/m/Y" }}</td>
          <td>{{ r.data_fim|date:"d/m/Y" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    {% if termo %}
      <p class="text-center text-muted mt-4">Nenhum resultado encontrado para <strong>{{ termo }}</strong>.</p>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
