{% extends "base.html" %}
{% block title %}Upload em Lote{% endblock %}
{% block content %}
<h1 class="h4 mb-3">Upload em Lote</h1>
<form method="post" enctype="multipart/form-data" class="card card-body">
  {% csrf_token %}
  {{ form.as_p }}
  <button class="btn btn-success">Enviar</button>
</form>
{% endblock %}
{% if relatorio %}
  <hr>
  <pre class="p-3 bg-light border rounded">{{ relatorio }}</pre>
{% endif %}

<hr class="my-4">

<h2 class="h5">Hist√≥rico recente</h2>
<div class="table-responsive">
  <table class="table table-sm align-middle">
    <thead>
      <tr>
        <th>Data</th>
        <th>Tipo</th>
        <th>Arquivo</th>
        <th>Status</th>
        <th>Processados</th>
        <th>Erros</th>
        <th>Log</th>
      </tr>
    </thead>
    <tbody>
      {% for u in uploads %}
      <tr>
        <td>{{ u.criado_em|date:"d/m/Y H:i" }}</td>
        <td>{{ u.get_tipo_display }}</td>
        <td>{{ u.arquivo_nome }}</td>
        <td>
          {% if u.ok %}
            <span class="badge bg-success">OK</span>
          {% else %}
            <span class="badge bg-danger">Falhou</span>
          {% endif %}
        </td>
        <td>{{ u.total_processado }}</td>
        <td>{{ u.total_erros }}</td>
        <td style="max-width: 420px; white-space: pre-wrap;">{{ u.log|default:"" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="7">Sem uploads ainda.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>